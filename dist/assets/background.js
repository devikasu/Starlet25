import{s as d}from"./summarizer.js";function f(e){const t=g(e),r=m(t),s=t.length,o=Math.ceil(r/200),n=h(t),c=S(t),i=T(t),l=p(e),u=E(e);return{originalText:e,wordCount:r,characterCount:s,estimatedReadingTime:o,summary:n,keywords:c,language:i,hasCode:l,hasLinks:u,processedAt:Date.now()}}function g(e){return e.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim()}function m(e){return e.split(/\s+/).filter(t=>t.length>0).length}function h(e,t=200){const r=e.split(/[.!?]+/).filter(o=>o.trim().length>0);let s="";for(const o of r){if((s+o).length>t)break;s+=o+". "}return s.trim()||e.substring(0,t)+"..."}function S(e,t=10){const r=e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(o=>o.length>3),s={};return r.forEach(o=>{s[o]=(s[o]||0)+1}),Object.entries(s).sort(([,o],[,n])=>n-o).slice(0,t).map(([o])=>o)}function T(e){const t=["the","and","or","but","in","on","at","to","for","of","with","by"],r=["el","la","de","que","y","a","en","un","es","se","no","te"],s=e.toLowerCase().split(/\s+/);let o=0,n=0;return s.forEach(c=>{t.includes(c)&&o++,r.includes(c)&&n++}),o>n?"en":n>o?"es":"unknown"}function p(e){return[/function\s+\w+\s*\(/,/const\s+\w+\s*=/,/let\s+\w+\s*=/,/var\s+\w+\s*=/,/if\s*\(/,/for\s*\(/,/while\s*\(/,/class\s+\w+/,/import\s+/,/export\s+/,/console\.log/,/return\s+/,/=>\s*/,/{[\s\S]*}/,/\[[\s\S]*\]/,/\([\s\S]*\)/].some(r=>r.test(e))}function E(e){return/https?:\/\/[^\s]+/g.test(e)}async function a(e){try{await chrome.scripting.executeScript({target:{tabId:e},files:["assets/content.js"]}),console.log("✅ Starlet25: Content script injected into tab",e)}catch(t){throw console.error("❌ Starlet25: Failed to inject content script:",t),t}}chrome.runtime.onMessage.addListener((e,t,r)=>{e.type==="PAGE_TEXT"&&(console.log(`[${new Date().toISOString()}] Extracted summary:`,e.text.slice(0,200)),r({success:!0}))});chrome.runtime.onMessage.addListener((e,t,r)=>{if(e.action==="PING")return console.log("Starlet25: Received PING request"),r({success:!0,message:"Starlet25 extension is running"}),!0;if(e.action==="EXTRACT_CURRENT_PAGE")return console.log("Starlet25: Received EXTRACT_CURRENT_PAGE request"),chrome.tabs.query({active:!0,currentWindow:!0},async s=>{const o=s[0];if(!o?.id){console.error("Starlet25: No active tab found for EXTRACT_CURRENT_PAGE"),r({success:!1,error:"No active tab found"});return}try{console.log("Starlet25: Injecting content script for extraction"),await a(o.id),chrome.tabs.sendMessage(o.id,{action:"EXTRACT_TEXT"},n=>{if(chrome.runtime.lastError)console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message),r({success:!1,error:"Content script not ready"});else if(n&&n.text){console.log("✅ Starlet25: Got response from content script",n);const c=f(n.text),i=d(n.text);console.log("Starlet25: Sending successful response"),r({success:!0,text:n.text,processed:c,summarization:i})}else console.log("Starlet25: No text extracted from content script"),r({success:!1,error:"No text extracted"})})}catch(n){console.error("❌ Starlet25: Failed to inject content script for extraction:",n),r({success:!1,error:"Content script injection failed"})}}),!0});chrome.runtime.onInstalled.addListener(()=>{console.log("Starlet25: Extension installed")});chrome.commands.onCommand.addListener(async e=>{if(e==="extract-text"){console.log("Starlet25: Ctrl+Alt+S received in background script");try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(console.log("Starlet25: Active tab found:",t?.id,t?.url),t?.id)try{console.log("Starlet25: Injecting content script..."),await a(t.id),console.log("Starlet25: Content script injected, sending EXTRACT_TEXT message"),chrome.tabs.sendMessage(t.id,{action:"EXTRACT_TEXT"},r=>{console.log("Starlet25: Received response from content script:",r),chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message):r&&r.success?console.log("✅ Starlet25: Text extraction started successfully"):console.error("❌ Starlet25: Failed to extract text - response:",r)})}catch(r){console.error("❌ Starlet25: Error extracting text",r)}else console.error("❌ Starlet25: No active tab found")}catch(t){console.error("❌ Starlet25: Error handling text extraction shortcut",t)}}if(e==="voice-assistant"){console.log("Starlet25: Alt+Shift+V received in background script");try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t?.id&&(await a(t.id),chrome.tabs.sendMessage(t.id,{action:"START_VOICE_ASSISTANT"},r=>{chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready for voice assistant",chrome.runtime.lastError.message):console.log("✅ Starlet25: Voice assistant started successfully")}))}catch(t){console.error("❌ Starlet25: Error starting voice assistant",t)}}});chrome.tabs.onUpdated.addListener((e,t,r)=>{t.status==="complete"&&r.url&&r.url.startsWith("http")&&(console.log(`Starlet25: Tab ${e} completed loading: ${r.url}`),setTimeout(async()=>{try{await a(e),console.log(`Starlet25: Content script injected on tab ${e}`)}catch(s){console.log(`ℹ️ Starlet25: Content script already injected or injection failed on tab ${e}:`,s)}},1e3))});
