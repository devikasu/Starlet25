import{p as l,s as u}from"./summarizer.js";async function c(r){try{await chrome.scripting.executeScript({target:{tabId:r},files:["assets/content.js"]}),console.log("✅ Starlet25: Content script injected into tab",r)}catch(t){throw console.error("❌ Starlet25: Failed to inject content script:",t),t}}chrome.runtime.onMessage.addListener((r,t,e)=>{r.type==="PAGE_TEXT"&&(console.log(`[${new Date().toISOString()}] Extracted summary:`,r.text.slice(0,200)),e({success:!0}))});chrome.runtime.onMessage.addListener((r,t,e)=>{if(r.action==="PING")return console.log("Starlet25: Received PING request"),e({success:!0,message:"Starlet25 extension is running"}),!0;if(r.action==="EXTRACT_CURRENT_PAGE")return console.log("Starlet25: Received EXTRACT_CURRENT_PAGE request"),chrome.tabs.query({active:!0,currentWindow:!0},async n=>{const s=n[0];if(!s?.id){console.error("Starlet25: No active tab found for EXTRACT_CURRENT_PAGE"),e({success:!1,error:"No active tab found"});return}try{console.log("Starlet25: Injecting content script for extraction"),await c(s.id),chrome.tabs.sendMessage(s.id,{action:"EXTRACT_TEXT"},o=>{if(chrome.runtime.lastError)console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message),e({success:!1,error:"Content script not ready"});else if(o&&o.text){console.log("✅ Starlet25: Got response from content script",o);const a=l(o.text),i=u(o.text);console.log("Starlet25: Sending successful response"),e({success:!0,text:o.text,processed:a,summarization:i})}else console.log("Starlet25: No text extracted from content script"),e({success:!1,error:"No text extracted"})})}catch(o){console.error("❌ Starlet25: Failed to inject content script for extraction:",o),e({success:!1,error:"Content script injection failed"})}}),!0});chrome.runtime.onInstalled.addListener(()=>{console.log("Starlet25: Extension installed")});chrome.commands.onCommand.addListener(async r=>{if(r==="extract-text"){console.log("Starlet25: Ctrl+Alt+S received in background script");try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(console.log("Starlet25: Active tab found:",t?.id,t?.url),t?.id)try{console.log("Starlet25: Injecting content script..."),await c(t.id),console.log("Starlet25: Content script injected, sending EXTRACT_TEXT message"),chrome.tabs.sendMessage(t.id,{action:"EXTRACT_TEXT"},e=>{console.log("Starlet25: Received response from content script:",e),chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message):e&&e.success?console.log("✅ Starlet25: Text extraction started successfully"):console.error("❌ Starlet25: Failed to extract text - response:",e)})}catch(e){console.error("❌ Starlet25: Error extracting text",e)}else console.error("❌ Starlet25: No active tab found")}catch(t){console.error("❌ Starlet25: Error handling text extraction shortcut",t)}}if(r==="voice-assistant"){console.log("Starlet25: Alt+Shift+V received in background script");try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t?.id&&(await c(t.id),chrome.tabs.sendMessage(t.id,{action:"START_VOICE_ASSISTANT"},e=>{chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready for voice assistant",chrome.runtime.lastError.message):console.log("✅ Starlet25: Voice assistant started successfully")}))}catch(t){console.error("❌ Starlet25: Error starting voice assistant",t)}}});chrome.tabs.onUpdated.addListener((r,t,e)=>{t.status==="complete"&&e.url&&e.url.startsWith("http")&&(console.log(`Starlet25: Tab ${r} completed loading: ${e.url}`),setTimeout(async()=>{try{await c(r),console.log(`Starlet25: Content script injected on tab ${r}`)}catch(n){console.log(`ℹ️ Starlet25: Content script already injected or injection failed on tab ${r}:`,n)}},1e3))});
