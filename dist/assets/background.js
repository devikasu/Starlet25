import{p as m}from"./textProcessor.js";const d=["algorithm","API","database","framework","function","method","object","class","variable","loop","condition","array","string","integer","boolean","null","undefined","callback","promise","async","await","module","package","library","dependency","version","deployment","production","development","testing","debugging","optimization","performance","security","authentication","authorization","encryption","compression","caching","scaling","microservices","monolith","frontend","backend","fullstack","responsive","accessibility","SEO"],y=["Object-Oriented Programming","Functional Programming","Procedural Programming","Event-Driven Programming","Reactive Programming","Declarative Programming","Imperative Programming","SOLID Principles","DRY Principle","KISS Principle","Design Patterns","Data Structures","Algorithms","Big O Notation","Memory Management","Garbage Collection","Threading","Concurrency","Asynchronous Programming","Error Handling","Logging","Monitoring"],w=[{id:"fallback_1",question:"What is this page about?",answer:"This page contains general information relevant to the user. The content has been extracted but could not be automatically summarized.",type:"concept",difficulty:"easy",tags:["general","fallback"]},{id:"fallback_2",question:"What can the user do with this extension?",answer:"Extract text from web pages, summarize content, generate flashcards for learning, and analyze page content for better understanding.",type:"concept",difficulty:"easy",tags:["extension","fallback"]},{id:"fallback_3",question:"How does text extraction work?",answer:"The extension identifies main content areas, removes navigation elements, and extracts clean text while avoiding ads, footers, and sidebars.",type:"process",difficulty:"medium",tags:["extraction","fallback"]},{id:"fallback_4",question:"What types of content can be processed?",answer:"Articles, documentation, tutorials, blog posts, and any text-based content. The extension works best with structured, informative content.",type:"fact",difficulty:"easy",tags:["content","fallback"]},{id:"fallback_5",question:"How can I use the text-to-speech feature?",answer:"Click the 🔊 Speak Summary button to have the page summary read aloud using your browser's text-to-speech capabilities.",type:"process",difficulty:"easy",tags:["speech","fallback"]},{id:"fallback_6",question:"What are the different flashcard types?",answer:"Definition cards explain terms, concept cards cover ideas, fact cards present information, and process cards describe how things work.",type:"concept",difficulty:"medium",tags:["flashcards","fallback"]}];function p(t){const n=f(t),e=S(t),o=T(t),a={text:C(n),keyPoints:E(n),topics:e,difficulty:o,confidence:v(t)};let s=x(t,e,o),i=!1;return(!s||s.length===0||a.confidence<.3)&&(s=[...w],i=!0,console.log("Starlet25: Using fallback flashcards due to low confidence or no content")),{summary:a,flashcards:s,generatedAt:Date.now(),isFallback:i}}function f(t){return t.split(/[.!?]+/).map(n=>n.trim()).filter(n=>n.length>10&&n.length<200).slice(0,20)}function h(t){return t.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(n=>n.length>3).filter(n=>!["this","that","with","have","will","from","they","know","want","been","good","much","some","time","very","when","come","just","into","than","more","other","about","many","then","them","these","people","only","well","also","over","still","take","every","think","here","again","another","around","because","before","should","through","during","first","going","great","might","never","often","place","right","small","sound","their","there","those","under","until","water","where","which","while","world","years","after","being","could","every","found","going","having","large","learn","never","other","place","right","small","sound","their","there","those","under","until","water","where","which","while","world","years"].includes(n))}function S(t){const n=[],e=t.toLowerCase();return d.some(o=>e.includes(o))&&n.push("Programming"),y.some(o=>e.includes(o.toLowerCase()))&&n.push("Software Development"),(e.includes("api")||e.includes("endpoint"))&&n.push("APIs"),(e.includes("database")||e.includes("sql")||e.includes("query"))&&n.push("Databases"),(e.includes("react")||e.includes("vue")||e.includes("angular"))&&n.push("Frontend Frameworks"),(e.includes("node")||e.includes("express")||e.includes("server"))&&n.push("Backend Development"),(e.includes("test")||e.includes("testing")||e.includes("unit"))&&n.push("Testing"),(e.includes("deploy")||e.includes("production")||e.includes("hosting"))&&n.push("Deployment"),(e.includes("security")||e.includes("authentication")||e.includes("encryption"))&&n.push("Security"),n.length===0&&n.push("General"),n.slice(0,3)}function T(t){const n=h(t),e=n.reduce((i,u)=>i+u.length,0)/n.length,o=f(t).length,a=d.filter(i=>t.toLowerCase().includes(i)).length;let s=0;return s+=e>8?2:e>6?1:0,s+=o>15?2:o>10?1:0,s+=a>5?2:a>2?1:0,s>=5?"hard":s>=2?"medium":"easy"}function v(t){const n=h(t),e=f(t);let o=.5;return n.length>100&&(o+=.2),e.length>5&&(o+=.1),d.some(a=>t.toLowerCase().includes(a))&&(o+=.1),(t.includes("function")||t.includes("class")||t.includes("method"))&&(o+=.1),Math.min(o,1)}function C(t){if(t.length===0)return"No content available for summarization.";const n=t.filter(o=>o.length>20&&o.length<120).slice(0,3).map(o=>o.replace(/\b(this|that|these|those|it|they|them)\b/gi,"").replace(/\b(is|are|was|were)\s+(a|an|the)\s+/gi,"is ").replace(/\s+/g," ").trim());if(n.length===0)return t[0]||"Content extracted but too short for meaningful summary.";let e=n.join(". ");return e.endsWith(".")||(e+="."),e.length>200&&(e=e.substring(0,197)+"..."),e}function E(t){return t.filter(n=>n.length>20&&n.length<100).slice(0,4).map(n=>n.replace(/\b(this|that|these|those)\b/gi,"").replace(/\s+/g," ").trim().substring(0,80))}function x(t,n,e){const o=[],a=A(t,n,e);o.push(...a);const s=k(t,n,e);return o.push(...s),o.slice(0,12)}function A(t,n,e){const o=[],a=f(t);return d.filter(r=>t.toLowerCase().includes(r)).slice(0,3).forEach((r,c)=>{o.push({id:`qa_def_${c}`,question:`What is ${r} and how is it used?`,answer:D(r,t),type:"definition",difficulty:e,tags:[...n,"definition","qa"]})}),a.filter(r=>r.length>40&&r.length<120).slice(0,2).forEach((r,c)=>{const l=P(r);l&&o.push({id:`qa_concept_${c}`,question:`How would you explain ${l} to someone new to this topic?`,answer:r,type:"concept",difficulty:e,tags:[...n,"concept","qa"]})}),a.filter(r=>r.includes("step")||r.includes("process")||r.includes("method")||r.includes("procedure")).slice(0,2).forEach((r,c)=>{const l=$(r);l&&o.push({id:`qa_process_${c}`,question:`What are the key steps involved in ${l}?`,answer:r,type:"process",difficulty:e,tags:[...n,"process","qa"]})}),o}function k(t,n,e){const o=[],a=h(t);return a.filter(r=>r.length>4&&d.includes(r)).slice(0,4).forEach((r,c)=>{o.push({id:`rev_keyword_${c}`,question:`Define: ${r}`,answer:_(r),type:"definition",difficulty:e,tags:[...n,"keyword","revision"]})}),f(t).filter(r=>r.includes("is")||r.includes("are")||r.includes("was")||r.includes("were")).slice(0,3).forEach((r,c)=>{const l=L(r);l&&o.push({id:`rev_fact_${c}`,question:`What is ${l}?`,answer:r.substring(0,100)+(r.length>100?"...":""),type:"fact",difficulty:e,tags:[...n,"fact","revision"]})}),a.filter(r=>r.length>5&&!d.includes(r)).slice(0,3).forEach((r,c)=>{o.push({id:`rev_concept_${c}`,question:`Quick: ${r}`,answer:`A key concept related to ${r} in this context.`,type:"concept",difficulty:e,tags:[...n,"concept","revision"]})}),o}function _(t){return{api:"Interface for software communication",function:"Reusable code block",variable:"Data storage container",class:"Object blueprint",method:"Class function",object:"Class instance",array:"Ordered data collection",string:"Text sequence",database:"Structured data storage",framework:"Development foundation",algorithm:"Problem-solving steps",loop:"Repeated execution",condition:"Decision logic",callback:"Function reference",promise:"Async operation result",module:"Code organization unit",package:"Dependency bundle",library:"Reusable code collection",dependency:"Required external code",deployment:"Application release",testing:"Code verification",debugging:"Error fixing",optimization:"Performance improvement",security:"Protection measures",authentication:"User verification",encryption:"Data protection",caching:"Temporary storage",scaling:"Performance expansion",frontend:"User interface",backend:"Server logic",responsive:"Adaptive design",accessibility:"Universal access",seo:"Search optimization"}[t.toLowerCase()]||`${t}: technical concept`}function D(t,n){const o=f(n).find(s=>s.toLowerCase().includes(t.toLowerCase()));return o||{api:"An Application Programming Interface (API) is a set of rules and protocols that allows different software applications to communicate with each other.",function:"A function is a reusable block of code that performs a specific task and can be called from other parts of the program.",variable:"A variable is a container that stores data values and can be referenced and manipulated throughout a program.",class:"A class is a blueprint for creating objects that defines their properties and methods.",method:"A method is a function that belongs to a class or object and defines the behavior of that class or object.",object:"An object is an instance of a class that contains data and code to manipulate that data.",array:"An array is a data structure that stores a collection of elements in a specific order.",string:"A string is a sequence of characters used to represent text in programming.",database:"A database is an organized collection of structured information or data stored electronically.",framework:"A framework is a pre-built structure that provides a foundation for developing applications."}[t.toLowerCase()]||`${t} is a technical concept used in software development.`}function P(t){const n=[/the concept of (\w+)/i,/(\w+) is a/i,/(\w+) refers to/i,/(\w+) means/i];for(const e of n){const o=t.match(e);if(o)return o[1]}return null}function L(t){const n=[/(\w+) is (\w+)/i,/(\w+) are (\w+)/i,/(\w+) was (\w+)/i,/(\w+) were (\w+)/i];for(const e of n){const o=t.match(e);if(o)return o[1]}return null}function $(t){const n=[/the (\w+) process/i,/(\w+) procedure/i,/(\w+) method/i,/steps to (\w+)/i];for(const e of n){const o=t.match(e);if(o)return o[1]}return null}async function g(t){try{await chrome.scripting.executeScript({target:{tabId:t},files:["assets/content.js"]}),console.log("✅ Starlet25: Content script injected into tab",t)}catch(n){throw console.error("❌ Starlet25: Failed to inject content script:",n),n}}async function b(t){try{const n=`page_text_${Date.now()}`,e=m(t.text),o=p(t.text),a={text:t.text,url:t.url,title:t.title,timestamp:t.timestamp,processed:e,summarization:o};await chrome.storage.local.set({[n]:a});const s=await chrome.storage.local.get(null),i=Object.keys(s).filter(u=>u.startsWith("page_text_"));if(i.length>10){const u=i.sort().slice(0,i.length-10);await chrome.storage.local.remove(u)}console.log(`[${new Date().toISOString()}] Extracted summary:`,t.text.slice(0,200)),console.log(`[${new Date().toISOString()}] Processed stats:`,{wordCount:e.wordCount,readingTime:e.estimatedReadingTime,language:e.language,hasCode:e.hasCode,hasLinks:e.hasLinks}),console.log(`[${new Date().toISOString()}] Generated ${o.flashcards.length} flashcards and summary with ${Math.round(o.summary.confidence*100)}% confidence${o.isFallback?" (FALLBACK USED)":""}`)}catch(n){console.error("Starlet25: Error storing text:",n)}}chrome.runtime.onMessage.addListener((t,n,e)=>{t.type==="PAGE_TEXT"&&(console.log(`[${new Date().toISOString()}] Extracted summary:`,t.text.slice(0,200)),b(t),e({success:!0}))});chrome.runtime.onMessage.addListener((t,n,e)=>{if(t.action==="PING")return console.log("🎤 Starlet25: Received PING request"),e({success:!0,message:"Starlet25 extension is running"}),!0;if(t.action==="GET_STORED_TEXTS")return console.log("🎤 Starlet25: Received GET_STORED_TEXTS request from voice assistant"),chrome.storage.local.get(null).then(o=>{const a=Object.entries(o).filter(([s])=>s.startsWith("page_text_")).map(([s,i])=>({id:s,...i})).sort((s,i)=>i.timestamp-s.timestamp);console.log("🎤 Starlet25: Retrieved stored texts count:",a.length),e({texts:a})}),!0;if(t.action==="CLEAR_STORED_TEXTS")return chrome.storage.local.get(null).then(o=>{const a=Object.keys(o).filter(s=>s.startsWith("page_text_"));chrome.storage.local.remove(a).then(()=>{e({success:!0})})}),!0;if(t.action==="EXTRACT_CURRENT_PAGE")return console.log("🎤 Starlet25: Received EXTRACT_CURRENT_PAGE request from voice assistant"),chrome.tabs.query({active:!0,currentWindow:!0},async o=>{const a=o[0];if(!a?.id){console.error("🎤 Starlet25: No active tab found for EXTRACT_CURRENT_PAGE"),e({success:!1,error:"No active tab found"});return}try{console.log("🎤 Starlet25: Injecting content script for extraction"),await g(a.id),chrome.tabs.sendMessage(a.id,{action:"EXTRACT_TEXT"},s=>{if(chrome.runtime.lastError)console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message),e({success:!1,error:"Content script not ready"});else if(s&&s.text){console.log("✅ Starlet25: Got response from content script",s);const i=m(s.text),u=p(s.text),r={type:"PAGE_TEXT",text:s.text,url:s.url,title:s.title,timestamp:Date.now()};b(r),console.log("🎤 Starlet25: Sending successful response to voice assistant"),e({success:!0,text:s.text,processed:i,summarization:u})}else console.log("🎤 Starlet25: No text extracted from content script"),e({success:!1,error:"No text extracted"})})}catch(s){console.error("❌ Starlet25: Failed to inject content script for extraction:",s),e({success:!1,error:"Content script injection failed"})}}),!0;if(t.action==="TOGGLE_ACCESSIBILITY"){const{enabled:o}=t;return console.log(`Starlet25: Toggling accessibility to ${o}`),chrome.tabs.query({active:!0,currentWindow:!0},async a=>{const s=a[0];if(!s?.id){console.error("Starlet25: No active tab found"),e({success:!1,error:"No active tab found"});return}try{await g(s.id),chrome.tabs.sendMessage(s.id,{action:"TOGGLE_ACCESSIBILITY",enabled:o},i=>{chrome.runtime.lastError?(console.warn("⚠️ Starlet25: Content script not ready for accessibility toggle",chrome.runtime.lastError.message),e({success:!1,error:"Content script not responding"})):i&&i.success?(console.log(`✅ Starlet25: Accessibility ${o?"enabled":"disabled"} successfully`),o&&s.id&&chrome.scripting.executeScript({target:{tabId:s.id},func:()=>{const u=window.AudioContext||window.webkitAudioContext,r=new u,c=r.createOscillator(),l=r.createGain();c.connect(l),l.connect(r.destination),c.frequency.setValueAtTime(800,r.currentTime),c.frequency.exponentialRampToValueAtTime(1200,r.currentTime+.1),l.gain.setValueAtTime(0,r.currentTime),l.gain.linearRampToValueAtTime(.3,r.currentTime+.05),l.gain.exponentialRampToValueAtTime(.01,r.currentTime+.3),c.start(r.currentTime),c.stop(r.currentTime+.3)}}),e({success:!0})):(console.error("❌ Starlet25: Failed to toggle accessibility - no response"),e({success:!1,error:"Failed to toggle accessibility"}))})}catch(i){console.error("❌ Starlet25: Error injecting content script:",i),e({success:!1,error:"Content script injection failed"})}}),!0}});chrome.runtime.onInstalled.addListener(()=>{console.log("Starlet25: Extension installed")});chrome.commands.onCommand.addListener(async t=>{if(t==="start-voice-assistant"){console.log("🎤 Starlet25: Alt+Shift+V received in background script");try{const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});if(console.log("🎤 Starlet25: Active tab found:",n?.id,n?.url),n?.id)try{console.log("🎤 Starlet25: Injecting content script..."),await g(n.id),console.log("🎤 Starlet25: Content script injected, sending START_VOICE_ASSISTANT message"),chrome.tabs.sendMessage(n.id,{action:"START_VOICE_ASSISTANT"},e=>{console.log("🎤 Starlet25: Received response from content script:",e),chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready for voice assistant",chrome.runtime.lastError.message):e&&e.success?console.log("✅ Starlet25: Voice assistant started successfully"):console.error("❌ Starlet25: Failed to start voice assistant - response:",e)})}catch(e){console.error("❌ Starlet25: Error starting voice assistant",e)}else console.error("❌ Starlet25: No active tab found")}catch(n){console.error("❌ Starlet25: Error handling voice assistant shortcut",n)}}});chrome.tabs.onUpdated.addListener((t,n,e)=>{n.status==="complete"&&e.url&&e.url.startsWith("http")&&(console.log(`Starlet25: Tab ${t} completed loading: ${e.url}`),setTimeout(async()=>{try{const a=(await chrome.storage.local.get(["accessibilityEnabled"])).accessibilityEnabled===!0;await g(t),chrome.tabs.sendMessage(t,{action:"EXTRACT_TEXT"},s=>{chrome.runtime.lastError?console.log(`Starlet25: Content script not ready for text extraction on tab ${t}:`,chrome.runtime.lastError.message):s&&console.log(`Starlet25: Text extracted from tab ${t}`)}),a&&(console.log(`Starlet25: Accessibility enabled, sending toggle message on tab ${t}`),chrome.tabs.sendMessage(t,{action:"TOGGLE_ACCESSIBILITY",enabled:!0},s=>{chrome.runtime.lastError?console.log(`⚠️ Starlet25: Content script not ready for accessibility on tab ${t}:`,chrome.runtime.lastError.message):s&&console.log(`✅ Starlet25: Accessibility enabled on tab ${t}`)}))}catch(o){console.log(`ℹ️ Starlet25: Content script already injected or injection failed on tab ${t}:`,o)}},1e3))});
