import{p as l,s as u}from"./summarizer.js";async function s(e){try{await chrome.scripting.executeScript({target:{tabId:e},files:["assets/content.js"]}),console.log("✅ Starlet25: Content script injected into tab",e)}catch(r){throw console.error("❌ Starlet25: Failed to inject content script:",r),r}}chrome.runtime.onMessage.addListener((e,r,t)=>{e.type==="PAGE_TEXT"&&(console.log(`[${new Date().toISOString()}] Extracted summary:`,e.text.slice(0,200)),t({success:!0}))});chrome.runtime.onMessage.addListener((e,r,t)=>{if(e.action==="PING")return console.log("Starlet25: Received PING request"),t({success:!0,message:"Starlet25 extension is running"}),!0;if(e.action==="EXTRACT_CURRENT_PAGE")return console.log("Starlet25: Received EXTRACT_CURRENT_PAGE request"),chrome.tabs.query({active:!0,currentWindow:!0},async c=>{const n=c[0];if(!n?.id){console.error("Starlet25: No active tab found for EXTRACT_CURRENT_PAGE"),t({success:!1,error:"No active tab found"});return}try{console.log("Starlet25: Injecting content script for extraction"),await s(n.id),chrome.tabs.sendMessage(n.id,{action:"EXTRACT_TEXT"},o=>{if(chrome.runtime.lastError)console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message),t({success:!1,error:"Content script not ready"});else if(o&&o.text){console.log("✅ Starlet25: Got response from content script",o);const a=l(o.text),i=u(o.text);console.log("Starlet25: Sending successful response"),t({success:!0,text:o.text,processed:a,summarization:i})}else console.log("Starlet25: No text extracted from content script"),t({success:!1,error:"No text extracted"})})}catch(o){console.error("❌ Starlet25: Failed to inject content script for extraction:",o),t({success:!1,error:"Content script injection failed"})}}),!0});chrome.runtime.onInstalled.addListener(()=>{console.log("Starlet25: Extension installed")});chrome.commands.onCommand.addListener(async e=>{if(e==="extract-text"){console.log("Starlet25: Ctrl+Alt+S received in background script");try{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(console.log("Starlet25: Active tab found:",r?.id,r?.url),r?.id)try{console.log("Starlet25: Injecting content script..."),await s(r.id),console.log("Starlet25: Content script injected, sending EXTRACT_TEXT message"),chrome.tabs.sendMessage(r.id,{action:"EXTRACT_TEXT"},t=>{console.log("Starlet25: Received response from content script:",t),chrome.runtime.lastError?console.warn("⚠️ Starlet25: Content script not ready",chrome.runtime.lastError.message):t&&t.success?console.log("✅ Starlet25: Text extraction started successfully"):console.error("❌ Starlet25: Failed to extract text - response:",t)})}catch(t){console.error("❌ Starlet25: Error extracting text",t)}else console.error("❌ Starlet25: No active tab found")}catch(r){console.error("❌ Starlet25: Error handling text extraction shortcut",r)}}});chrome.tabs.onUpdated.addListener((e,r,t)=>{r.status==="complete"&&t.url&&t.url.startsWith("http")&&(console.log(`Starlet25: Tab ${e} completed loading: ${t.url}`),setTimeout(async()=>{try{await s(e),console.log(`Starlet25: Content script injected on tab ${e}`)}catch(c){console.log(`ℹ️ Starlet25: Content script already injected or injection failed on tab ${e}:`,c)}},1e3))});
