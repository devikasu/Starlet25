var T=Object.defineProperty;var k=(s,e,t)=>e in s?T(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>k(s,typeof e!="symbol"?e+"":e,t);class x{constructor(){d(this,"recognition",null);d(this,"synthesis",null);d(this,"isListening",!1);d(this,"isSpeaking",!1);d(this,"commands",[]);d(this,"onStateChange",null);this.initializeSpeechRecognition(),this.initializeSpeechSynthesis(),this.setupCommands()}initializeSpeechRecognition(){if(console.log("ðŸŽ¤ Starlet25: Initializing speech recognition..."),console.log("ðŸŽ¤ Starlet25: SpeechRecognition available:","SpeechRecognition"in window),console.log("ðŸŽ¤ Starlet25: webkitSpeechRecognition available:","webkitSpeechRecognition"in window),"webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;console.log("ðŸŽ¤ Starlet25: Creating SpeechRecognition instance..."),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!1,this.recognition.lang="en-US",this.recognition.maxAlternatives=1,this.recognition.onstart=()=>{console.log("ðŸŽ¤ Starlet25: Voice recognition started"),this.isListening=!0,this.updateState()},this.recognition.onresult=t=>{const n=t.results[0][0].transcript.toLowerCase().trim();console.log("ðŸŽ¤ Starlet25: onresult fired with transcript:",n),console.log("ðŸŽ¤ Starlet25: Processing command..."),this.processCommand(n)},this.recognition.onerror=t=>{console.error("ðŸŽ¤ Starlet25: Speech recognition error:",t.error),this.speak("Sorry, I did not understand. Please try again."),this.isListening=!1,this.updateState()},this.recognition.onend=()=>{console.log("ðŸŽ¤ Starlet25: Voice recognition ended"),this.isListening=!1,this.updateState()},console.log("ðŸŽ¤ Starlet25: Speech recognition initialized successfully")}else console.error("ðŸŽ¤ Starlet25: Speech recognition not supported")}initializeSpeechSynthesis(){"speechSynthesis"in window?this.synthesis=window.speechSynthesis:console.error("ðŸŽ¤ Starlet25: Speech synthesis not supported")}setupCommands(){this.commands=[{command:"summarize page",description:"Extract and summarize the current page content",action:async()=>{await this.handleSummarizePage()}},{command:"read flashcards",description:"Read the generated flashcards aloud",action:async()=>{await this.handleReadFlashcards()}},{command:"read summary",description:"Read the page summary aloud",action:async()=>{await this.handleReadSummary()}},{command:"toggle accessibility",description:"Turn accessibility mode on or off",action:async()=>{await this.handleToggleAccessibility()}},{command:"help",description:"List all available voice commands",action:async()=>{await this.handleHelp()}},{command:"stop",description:"Stop current speech or listening",action:async()=>{await this.handleStop()}},{command:"clear data",description:"Clear all stored page data",action:async()=>{await this.handleClearData()}}]}startListening(){if(console.log("ðŸŽ¤ Starlet25: startListening called"),console.log("ðŸŽ¤ Starlet25: recognition available:",!!this.recognition),console.log("ðŸŽ¤ Starlet25: isListening:",this.isListening),!this.recognition){console.error("ðŸŽ¤ Starlet25: Speech recognition not available"),this.speak("Speech recognition is not available in this browser.");return}if(this.isListening){console.log("ðŸŽ¤ Starlet25: Already listening, ignoring start request"),this.speak("Already listening for commands.");return}console.log("ðŸŽ¤ Starlet25: Starting speech recognition..."),this.speak("Listening. Please say a command.");try{this.recognition.start(),console.log("ðŸŽ¤ Starlet25: Speech recognition start() called successfully")}catch(e){console.error("ðŸŽ¤ Starlet25: Error starting recognition:",e),this.speak("Error starting voice recognition. Please try again.")}}stopListening(){this.recognition&&this.isListening&&this.recognition.stop()}speak(e){if(!this.synthesis){console.error("ðŸŽ¤ Starlet25: Speech synthesis not available");return}this.synthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.rate=.9,t.pitch=1,t.volume=1,t.lang="en-US",t.onstart=()=>{console.log("ðŸŽ¤ Starlet25: Speaking:",e),this.isSpeaking=!0,this.updateState()},t.onend=()=>{console.log("ðŸŽ¤ Starlet25: Finished speaking"),this.isSpeaking=!1,this.updateState()},t.onerror=n=>{console.error("ðŸŽ¤ Starlet25: Speech error:",n.error),this.isSpeaking=!1,this.updateState()},this.synthesis.speak(t)}async processCommand(e){console.log("ðŸŽ¤ Starlet25: processCommand called with transcript:",e);const t=this.findBestMatch(e);if(console.log("ðŸŽ¤ Starlet25: findBestMatch returned:",t?.command||"null"),t){console.log("ðŸŽ¤ Starlet25: Executing command:",t.command),this.speak(`Executing ${t.command}`);try{await t.action(),console.log("ðŸŽ¤ Starlet25: Command execution completed successfully")}catch(n){console.error("ðŸŽ¤ Starlet25: Error executing command:",n),this.speak("Sorry, there was an error executing that command.")}}else console.log("ðŸŽ¤ Starlet25: Command not recognized:",e),this.speak(`Command not recognized: ${e}. Say "help" for available commands.`)}findBestMatch(e){console.log("ðŸŽ¤ Starlet25: findBestMatch called with transcript:",e),console.log("ðŸŽ¤ Starlet25: Available commands:",this.commands.map(o=>o.command));const t=this.commands.find(o=>e.includes(o.command.toLowerCase()));if(t)return console.log("ðŸŽ¤ Starlet25: Found exact match:",t.command),t;const n={"summarize page":["summarize","summary","summarize this page","page summary"],"read flashcards":["flashcards","read cards","show flashcards","flash card"],"read summary":["read summary","summary","tell me summary"],"toggle accessibility":["accessibility","toggle","turn on accessibility","turn off accessibility"],help:["help","commands","what can you do","list commands"],stop:["stop","cancel","quit","end"],"clear data":["clear","clear data","delete data","reset"]};for(const[o,a]of Object.entries(n))if(a.some(i=>e.includes(i))){const i=this.commands.find(u=>u.command===o);return console.log("ðŸŽ¤ Starlet25: Found fuzzy match:",o,"->",i?.command),i||null}return console.log("ðŸŽ¤ Starlet25: No match found for transcript:",e),null}async handleSummarizePage(){console.log("ðŸŽ¤ Starlet25: handleSummarizePage called");try{this.speak("Extracting and summarizing the current page."),console.log("ðŸŽ¤ Starlet25: Sending message: EXTRACT_CURRENT_PAGE");const e=await new Promise((t,n)=>{chrome.runtime.sendMessage({action:"EXTRACT_CURRENT_PAGE"},o=>{console.log("ðŸŽ¤ Starlet25: Received response for EXTRACT_CURRENT_PAGE:",o),chrome.runtime.lastError?(console.error("ðŸŽ¤ Starlet25: Runtime error:",chrome.runtime.lastError),n(new Error(chrome.runtime.lastError.message))):t(o)})});if(e.success){const t=e.summarization;console.log("ðŸŽ¤ Starlet25: Summarization result:",t),t?.summary?.text?this.speak(`Summary complete. ${t.summary.text}`):this.speak("Summary generated but no content found.")}else console.log("ðŸŽ¤ Starlet25: Extract current page failed:",e),this.speak("Sorry, could not summarize this page.")}catch(e){console.error("ðŸŽ¤ Starlet25: Error summarizing page:",e),this.speak("Error summarizing page. Please try again.")}}async handleReadFlashcards(){console.log("ðŸŽ¤ Starlet25: handleReadFlashcards called");try{this.speak("Reading flashcards."),console.log("ðŸŽ¤ Starlet25: Sending message: GET_STORED_TEXTS");const t=(await new Promise((n,o)=>{chrome.runtime.sendMessage({action:"GET_STORED_TEXTS"},a=>{console.log("ðŸŽ¤ Starlet25: Received response for GET_STORED_TEXTS:",a),chrome.runtime.lastError?(console.error("ðŸŽ¤ Starlet25: Runtime error:",chrome.runtime.lastError),o(new Error(chrome.runtime.lastError.message))):n(a)})})).texts||[];if(console.log("ðŸŽ¤ Starlet25: Retrieved texts count:",t.length),t.length>0){const n=t[0];if(console.log("ðŸŽ¤ Starlet25: Latest text data:",n),n.summarization?.flashcards?.length>0){const o=n.summarization.flashcards;console.log("ðŸŽ¤ Starlet25: Found flashcards:",o.length),this.speak(`Found ${o.length} flashcards. Reading them now.`);for(let a=0;a<Math.min(o.length,5);a++){const i=o[a];await this.speakWithDelay(`Card ${a+1}. Question: ${i.question}. Answer: ${i.answer}`,2e3)}o.length>5&&this.speak(`And ${o.length-5} more flashcards available.`)}else console.log("ðŸŽ¤ Starlet25: No flashcards found in latest text"),this.speak("No flashcards found. Please summarize a page first.")}else console.log("ðŸŽ¤ Starlet25: No stored texts found"),this.speak("No content found. Please summarize a page first.")}catch(e){console.error("ðŸŽ¤ Starlet25: Error reading flashcards:",e),this.speak("Error reading flashcards. Please try again.")}}async handleReadSummary(){try{this.speak("Reading page summary.");const t=(await new Promise((n,o)=>{chrome.runtime.sendMessage({action:"GET_STORED_TEXTS"},a=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):n(a)})})).texts||[];if(t.length>0){const n=t[0];n.summarization?.summary?.text?this.speak(n.summarization.summary.text):this.speak("No summary found. Please summarize a page first.")}else this.speak("No content found. Please summarize a page first.")}catch(e){console.error("ðŸŽ¤ Starlet25: Error reading summary:",e),this.speak("Error reading summary. Please try again.")}}async handleToggleAccessibility(){try{const n=!((await chrome.storage.local.get(["accessibilityEnabled"])).accessibilityEnabled===!0);await chrome.storage.local.set({accessibilityEnabled:n}),(await new Promise((a,i)=>{chrome.runtime.sendMessage({action:"TOGGLE_ACCESSIBILITY",enabled:n},u=>{chrome.runtime.lastError?i(new Error(chrome.runtime.lastError.message)):a(u)})})).success?this.speak(`Accessibility ${n?"enabled":"disabled"}. ${n?"Press Alt+N to read page content.":""}`):this.speak("Error toggling accessibility.")}catch(e){console.error("ðŸŽ¤ Starlet25: Error toggling accessibility:",e),this.speak("Error toggling accessibility. Please try again.")}}async handleHelp(){this.speak("Available voice commands:");for(const e of this.commands)await this.speakWithDelay(`${e.command}: ${e.description}`,1e3);this.speak("Say any command to execute it.")}async handleStop(){this.synthesis?.cancel(),this.stopListening(),this.speak("Stopped.")}async handleClearData(){try{(await new Promise((t,n)=>{chrome.runtime.sendMessage({action:"CLEAR_STORED_TEXTS"},o=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):t(o)})})).success?this.speak("All stored data cleared."):this.speak("Error clearing data.")}catch(e){console.error("ðŸŽ¤ Starlet25: Error clearing data:",e),this.speak("Error clearing data. Please try again.")}}async speakWithDelay(e,t){return new Promise(n=>{setTimeout(()=>{this.speak(e),n()},t)})}setStateChangeCallback(e){this.onStateChange=e}updateState(){this.onStateChange&&this.onStateChange({isListening:this.isListening,isSpeaking:this.isSpeaking,currentCommand:this.isListening?"Listening for commands...":null})}getState(){return{isListening:this.isListening,isSpeaking:this.isSpeaking,currentCommand:this.isListening?"Listening for commands...":null}}isSupported(){return!!(this.recognition&&this.synthesis)}}const c=new x;console.log("ðŸ”Š Starlet25 content script loaded. Waiting for Alt+N...");console.log("ðŸŽ¤ Starlet25: Voice assistant imported:",!!c);console.log("ðŸŽ¤ Starlet25: Voice assistant supported:",c.isSupported());let r=!1,l=null;async function y(){try{r=(await chrome.storage.local.get(["accessibilityEnabled"])).accessibilityEnabled===!0,console.log("Starlet25: Checking accessibility status:",r),r&&!l?(console.log("Starlet25: Enabling accessibility listener"),f()):!r&&l&&(console.log("Starlet25: Disabling accessibility listener"),g()),console.log("Starlet25: Current state - accessibilityEnabled:",r,"keydownListener:",!!l)}catch(s){console.error("Starlet25: Error checking accessibility status:",s)}}function f(){l||(l=s=>{s.altKey&&s.key.toLowerCase()==="n"&&(s.preventDefault(),s.stopPropagation(),console.log("Starlet25: Alt+N pressed - reading content"),w(),E())},document.addEventListener("keydown",l,!0),console.log("Starlet25: Accessibility listener attached (Alt+N to read content)"),setTimeout(()=>{console.log("Starlet25: Accessibility listener status - enabled:",r,"listener attached:",!!l)},1e3))}function g(){l&&(document.removeEventListener("keydown",l,!0),l=null,console.log("Starlet25: Accessibility listener removed"))}function E(){try{const s=h();if(!s||s.trim().length===0){p("No visible content found on this page.");return}const e=500,t=s.length>e?s.substring(0,e)+"... (content truncated)":s;p(t)}catch(s){console.error("Starlet25: Error reading content:",s),p("Error reading page content.")}}function p(s){if("speechSynthesis"in window){speechSynthesis.cancel();const e=new SpeechSynthesisUtterance(s);e.rate=.9,e.pitch=1,e.volume=1,e.onstart=()=>{console.log("Starlet25: Started reading content aloud"),w()},e.onend=()=>{console.log("Starlet25: Finished reading content"),m()},e.onerror=t=>{console.error("Starlet25: Speech error:",t.error),m()},speechSynthesis.speak(e)}else console.error("Starlet25: Speech synthesis not supported")}function w(){m();const s=document.createElement("div");s.id="starlet25-reading-indicator",s.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    z-index: 10000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: starlet25-pulse 1.5s infinite;
  `,s.textContent="ðŸ”Š Reading content...";const e=document.createElement("style");e.textContent=`
    @keyframes starlet25-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  `,document.head.appendChild(e),document.body.appendChild(s)}function m(){const s=document.getElementById("starlet25-reading-indicator");s&&s.remove()}function v(){const s=["main","article",'[role="main"]',".main-content",".content",".post-content",".entry-content","#content","#main"];for(const a of s){const i=document.querySelector(a);if(i instanceof HTMLElement)return i}const e=document.body,t=Array.from(e.querySelectorAll("div, section, article, main")).filter(a=>a instanceof HTMLElement);let n=e,o=e.innerText.length;return t.forEach(a=>{const i=a.innerText.length;i>o&&i>100&&(o=i,n=a)}),n}function A(s){["nav","header","footer","aside",".nav",".navigation",".navbar",".header",".footer",".sidebar",".advertisement",".ads",".ad",".social-share",".share-buttons",".comments",".comment-section",".related-posts",".recommendations",".breadcrumb",".breadcrumbs",".menu",".menu-item",".search",".search-box",".newsletter",".subscribe",".cookie-notice",".privacy-notice",".banner",".popup",".modal",".overlay",'[role="navigation"]','[role="banner"]','[role="complementary"]','[role="contentinfo"]','[aria-label*="navigation"]','[aria-label*="menu"]','[class*="nav"]','[class*="menu"]','[class*="header"]','[class*="footer"]','[class*="sidebar"]','[class*="ad"]','[id*="nav"]','[id*="menu"]','[id*="header"]','[id*="footer"]','[id*="sidebar"]','[id*="ad"]'].forEach(t=>{s.querySelectorAll(t).forEach(n=>{n.parentNode&&n.parentNode.removeChild(n)})}),s.querySelectorAll("script, style, noscript, iframe, embed, object").forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})}function C(s){return s.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim()}function h(){const s=v();if(!s)return"";const e=s.cloneNode(!0);A(e);let t=e.innerText||e.textContent||"";return t=C(t),t.split(`
`).filter(o=>{const a=o.trim();return a.length>10||a.length===0}).join(`
`).trim()}function S(){const s=h();if(s.length<50){console.log("Starlet25: Not enough text content found");return}const e={type:"PAGE_TEXT",text:s,url:window.location.href,title:document.title,timestamp:Date.now()};chrome.runtime.sendMessage(e,t=>{chrome.runtime.lastError?console.log("Starlet25: Error sending message to background:",chrome.runtime.lastError.message):t&&console.log("Starlet25: Message sent successfully to background")}),console.log("Starlet25: Extracted text length:",s.length)}chrome.runtime.onMessage.addListener((s,e,t)=>{if(s.action==="EXTRACT_TEXT"){const n=h();t({text:n,url:window.location.href,title:document.title})}if(s.action==="TOGGLE_ACCESSIBILITY"){const{enabled:n}=s;r=n,console.log("Starlet25: Toggling accessibility to:",n),n?f():(g(),m()),setTimeout(()=>{console.log("Starlet25: After toggle - accessibilityEnabled:",r,"keydownListener:",!!l)},100),t({success:!0})}if(s.action==="GET_ACCESSIBILITY_STATUS"&&t({enabled:r}),s.action==="START_VOICE_ASSISTANT"){console.log("ðŸŽ¤ Starlet25: Received START_VOICE_ASSISTANT command in content script");try{console.log("ðŸŽ¤ Starlet25: voiceAssistant object:",c),console.log("ðŸŽ¤ Starlet25: voiceAssistant.isSupported():",c.isSupported()),c.isSupported()?(console.log("ðŸŽ¤ Starlet25: Voice assistant is supported, calling startListening()"),c.startListening(),console.log("ðŸŽ¤ Starlet25: startListening() called successfully"),t({success:!0})):(console.error("ðŸŽ¤ Starlet25: Voice assistant not supported"),t({success:!1,error:"Voice assistant not supported"}))}catch(n){console.error("ðŸŽ¤ Starlet25: Error starting voice assistant:",n),t({success:!1,error:"Failed to start voice assistant"})}}if(s.action==="APPLY_SATURATION_FILTER"){console.log("ðŸŽ¨ Starlet25: Received APPLY_SATURATION_FILTER command in content script");try{const{saturation:n}=s;console.log("ðŸŽ¨ Starlet25: Applying saturation filter:",n+"%");const o=document.getElementById("starlet25-saturation-filter");if(o&&o.remove(),n!==100){const a=document.createElement("style");a.id="starlet25-saturation-filter",a.textContent=`
          html {
            filter: saturate(${n}%) !important;
          }
        `,document.head.appendChild(a),console.log("ðŸŽ¨ Starlet25: Saturation filter applied successfully")}else console.log("ðŸŽ¨ Starlet25: Saturation reset to normal (100%)");t({success:!0})}catch(n){console.error("ðŸŽ¨ Starlet25: Error applying saturation filter:",n),t({success:!1,error:"Failed to apply saturation filter"})}}});chrome.storage.onChanged.addListener((s,e)=>{e==="local"&&s.accessibilityEnabled&&(r=s.accessibilityEnabled.newValue===!0,console.log("Starlet25: Storage changed - accessibilityEnabled:",r),r&&!l?(console.log("Starlet25: Enabling accessibility from storage change"),f()):!r&&l&&(console.log("Starlet25: Disabling accessibility from storage change"),g(),m()))});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{S(),y()}):(S(),y());let b=0;const L=new MutationObserver(()=>{const s=h();Math.abs(s.length-b)>100&&(b=s.length,S())});L.observe(document.body,{childList:!0,subtree:!0});window.addEventListener("beforeunload",()=>{g(),m()});function R(){console.log("Starlet25: Testing accessibility reading..."),console.log("Starlet25: Current state - accessibilityEnabled:",r,"keydownListener:",!!l),r?E():console.log("Starlet25: Accessibility is disabled")}window.testStarlet25Accessibility=R;window.testStarlet25VoiceAssistant=()=>(console.log("ðŸŽ¤ Starlet25: Testing voice assistant manually..."),console.log("ðŸŽ¤ Starlet25: voiceAssistant object:",c),console.log("ðŸŽ¤ Starlet25: voiceAssistant.isSupported():",c.isSupported()),c.isSupported()?(console.log("ðŸŽ¤ Starlet25: Starting voice assistant test..."),c.startListening(),"Voice assistant started successfully"):(console.error("ðŸŽ¤ Starlet25: Voice assistant not supported"),"Voice assistant not supported"));
