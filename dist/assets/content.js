console.log("ðŸ”Š Starlet25 content script loaded. Waiting for Alt+N...");let o=!1,i=null;async function h(){try{o=(await chrome.storage.local.get(["accessibilityEnabled"])).accessibilityEnabled===!0,console.log("Starlet25: Checking accessibility status:",o),o&&!i?(console.log("Starlet25: Enabling accessibility listener"),b()):!o&&i&&(console.log("Starlet25: Disabling accessibility listener"),d()),console.log("Starlet25: Current state - accessibilityEnabled:",o,"keydownListener:",!!i)}catch(e){console.error("Starlet25: Error checking accessibility status:",e)}}function b(){i||(i=e=>{e.altKey&&e.key.toLowerCase()==="n"&&(e.preventDefault(),e.stopPropagation(),console.log("Starlet25: Alt+N pressed - reading content"),p(),y())},document.addEventListener("keydown",i,!0),console.log("Starlet25: Accessibility listener attached (Alt+N to read content)"),setTimeout(()=>{console.log("Starlet25: Accessibility listener status - enabled:",o,"listener attached:",!!i)},1e3))}function d(){i&&(document.removeEventListener("keydown",i,!0),i=null,console.log("Starlet25: Accessibility listener removed"))}function y(){try{const e=g();if(!e||e.trim().length===0){u("No visible content found on this page.");return}const t=500,n=e.length>t?e.substring(0,t)+"... (content truncated)":e;u(n)}catch(e){console.error("Starlet25: Error reading content:",e),u("Error reading page content.")}}function u(e){if("speechSynthesis"in window){speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e);t.rate=.9,t.pitch=1,t.volume=1,t.onstart=()=>{console.log("Starlet25: Started reading content aloud"),p()},t.onend=()=>{console.log("Starlet25: Finished reading content"),l()},t.onerror=n=>{console.error("Starlet25: Speech error:",n.error),l()},speechSynthesis.speak(t)}else console.error("Starlet25: Speech synthesis not supported")}function p(){l();const e=document.createElement("div");e.id="starlet25-reading-indicator",e.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    z-index: 10000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: starlet25-pulse 1.5s infinite;
  `,e.textContent="ðŸ”Š Reading content...";const t=document.createElement("style");t.textContent=`
    @keyframes starlet25-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  `,document.head.appendChild(t),document.body.appendChild(e)}function l(){const e=document.getElementById("starlet25-reading-indicator");e&&e.remove()}function S(){const e=["main","article",'[role="main"]',".main-content",".content",".post-content",".entry-content","#content","#main"];for(const s of e){const a=document.querySelector(s);if(a instanceof HTMLElement)return a}const t=document.body,n=Array.from(t.querySelectorAll("div, section, article, main")).filter(s=>s instanceof HTMLElement);let r=t,c=t.innerText.length;return n.forEach(s=>{const a=s.innerText.length;a>c&&a>100&&(c=a,r=s)}),r}function E(e){["nav","header","footer","aside",".nav",".navigation",".navbar",".header",".footer",".sidebar",".advertisement",".ads",".ad",".social-share",".share-buttons",".comments",".comment-section",".related-posts",".recommendations",".breadcrumb",".breadcrumbs",".menu",".menu-item",".search",".search-box",".newsletter",".subscribe",".cookie-notice",".privacy-notice",".banner",".popup",".modal",".overlay",'[role="navigation"]','[role="banner"]','[role="complementary"]','[role="contentinfo"]','[aria-label*="navigation"]','[aria-label*="menu"]','[class*="nav"]','[class*="menu"]','[class*="header"]','[class*="footer"]','[class*="sidebar"]','[class*="ad"]','[id*="nav"]','[id*="menu"]','[id*="header"]','[id*="footer"]','[id*="sidebar"]','[id*="ad"]'].forEach(n=>{e.querySelectorAll(n).forEach(r=>{r.parentNode&&r.parentNode.removeChild(r)})}),e.querySelectorAll("script, style, noscript, iframe, embed, object").forEach(n=>{n.parentNode&&n.parentNode.removeChild(n)})}function x(e){return e.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim()}function g(){const e=S();if(!e)return"";const t=e.cloneNode(!0);E(t);let n=t.innerText||t.textContent||"";return n=x(n),n.split(`
`).filter(c=>{const s=c.trim();return s.length>10||s.length===0}).join(`
`).trim()}function m(){const e=g();if(e.length<50){console.log("Starlet25: Not enough text content found");return}const t={type:"PAGE_TEXT",text:e,url:window.location.href,title:document.title,timestamp:Date.now()};chrome.runtime.sendMessage(t,n=>{chrome.runtime.lastError?console.log("Starlet25: Error sending message to background:",chrome.runtime.lastError.message):n&&console.log("Starlet25: Message sent successfully to background")}),console.log("Starlet25: Extracted text length:",e.length)}chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.action==="EXTRACT_TEXT"){const r=g();n({text:r,url:window.location.href,title:document.title})}if(e.action==="TOGGLE_ACCESSIBILITY"){const{enabled:r}=e;o=r,console.log("Starlet25: Toggling accessibility to:",r),r?b():(d(),l()),setTimeout(()=>{console.log("Starlet25: After toggle - accessibilityEnabled:",o,"keydownListener:",!!i)},100),n({success:!0})}e.action==="GET_ACCESSIBILITY_STATUS"&&n({enabled:o})});chrome.storage.onChanged.addListener((e,t)=>{t==="local"&&e.accessibilityEnabled&&(o=e.accessibilityEnabled.newValue===!0,console.log("Starlet25: Storage changed - accessibilityEnabled:",o),o&&!i?(console.log("Starlet25: Enabling accessibility from storage change"),b()):!o&&i&&(console.log("Starlet25: Disabling accessibility from storage change"),d(),l()))});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{m(),h()}):(m(),h());let f=0;const T=new MutationObserver(()=>{const e=g();Math.abs(e.length-f)>100&&(f=e.length,m())});T.observe(document.body,{childList:!0,subtree:!0});window.addEventListener("beforeunload",()=>{d(),l()});function v(){console.log("Starlet25: Testing accessibility reading..."),console.log("Starlet25: Current state - accessibilityEnabled:",o,"keydownListener:",!!i),o?y():console.log("Starlet25: Accessibility is disabled")}window.testStarlet25Accessibility=v;
