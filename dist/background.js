function m(e){const t=y(e),n=b(t),s=t.length,r=Math.ceil(n/200),o=T(t),a=S(t),c=v(t),f=C(e),i=E(e);return{originalText:e,wordCount:n,characterCount:s,estimatedReadingTime:r,summary:o,keywords:a,language:c,hasCode:f,hasLinks:i,processedAt:Date.now()}}function y(e){return e.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim()}function b(e){return e.split(/\s+/).filter(t=>t.length>0).length}function T(e,t=200){const n=e.split(/[.!?]+/).filter(r=>r.trim().length>0);let s="";for(const r of n){if((s+r).length>t)break;s+=r+". "}return s.trim()||e.substring(0,t)+"..."}function S(e,t=10){const n=e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(r=>r.length>3),s={};return n.forEach(r=>{s[r]=(s[r]||0)+1}),Object.entries(s).sort(([,r],[,o])=>o-r).slice(0,t).map(([r])=>r)}function v(e){const t=["the","and","or","but","in","on","at","to","for","of","with","by"],n=["el","la","de","que","y","a","en","un","es","se","no","te"],s=e.toLowerCase().split(/\s+/);let r=0,o=0;return s.forEach(a=>{t.includes(a)&&r++,n.includes(a)&&o++}),r>o?"en":o>r?"es":"unknown"}function C(e){return[/function\s+\w+\s*\(/,/const\s+\w+\s*=/,/let\s+\w+\s*=/,/var\s+\w+\s*=/,/if\s*\(/,/for\s*\(/,/while\s*\(/,/class\s+\w+/,/import\s+/,/export\s+/,/console\.log/,/return\s+/,/=>\s*/,/{[\s\S]*}/,/\[[\s\S]*\]/,/\([\s\S]*\)/].some(n=>n.test(e))}function E(e){return/https?:\/\/[^\s]+/g.test(e)}const h=["algorithm","API","database","framework","function","method","object","class","variable","loop","condition","array","string","integer","boolean","null","undefined","callback","promise","async","await","module","package","library","dependency","version","deployment","production","development","testing","debugging","optimization","performance","security","authentication","authorization","encryption","compression","caching","scaling","microservices","monolith","frontend","backend","fullstack","responsive","accessibility","SEO"],P=["Object-Oriented Programming","Functional Programming","Procedural Programming","Event-Driven Programming","Reactive Programming","Declarative Programming","Imperative Programming","SOLID Principles","DRY Principle","KISS Principle","Design Patterns","Data Structures","Algorithms","Big O Notation","Memory Management","Garbage Collection","Threading","Concurrency","Asynchronous Programming","Error Handling","Logging","Monitoring"];function g(e){const t=d(e),n=x(e),s=k(e),r={text:D(t),keyPoints:_(t),topics:n,difficulty:s,confidence:A(e)},o=L(e,n,s);return{summary:r,flashcards:o,generatedAt:Date.now()}}function d(e){return e.split(/[.!?]+/).map(t=>t.trim()).filter(t=>t.length>10&&t.length<200).slice(0,20)}function p(e){return e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(t=>t.length>3).filter(t=>!["this","that","with","have","will","from","they","know","want","been","good","much","some","time","very","when","come","just","into","than","more","other","about","many","then","them","these","people","only","well","also","over","still","take","every","think","here","again","another","around","because","before","should","through","during","first","going","great","might","never","often","place","right","small","sound","their","there","those","under","until","water","where","which","while","world","years","after","being","could","every","found","going","having","large","learn","never","other","place","right","small","sound","their","there","those","under","until","water","where","which","while","world","years"].includes(t))}function x(e){const t=[],n=e.toLowerCase();return h.some(s=>n.includes(s))&&t.push("Programming"),P.some(s=>n.includes(s.toLowerCase()))&&t.push("Software Development"),(n.includes("api")||n.includes("endpoint"))&&t.push("APIs"),(n.includes("database")||n.includes("sql")||n.includes("query"))&&t.push("Databases"),(n.includes("react")||n.includes("vue")||n.includes("angular"))&&t.push("Frontend Frameworks"),(n.includes("node")||n.includes("express")||n.includes("server"))&&t.push("Backend Development"),(n.includes("test")||n.includes("testing")||n.includes("unit"))&&t.push("Testing"),(n.includes("deploy")||n.includes("production")||n.includes("hosting"))&&t.push("Deployment"),(n.includes("security")||n.includes("authentication")||n.includes("encryption"))&&t.push("Security"),t.length===0&&t.push("General"),t.slice(0,3)}function k(e){const t=p(e),n=t.reduce((a,c)=>a+c.length,0)/t.length,s=d(e).length,r=h.filter(a=>e.toLowerCase().includes(a)).length;let o=0;return o+=n>8?2:n>6?1:0,o+=s>15?2:s>10?1:0,o+=r>5?2:r>2?1:0,o>=5?"hard":o>=2?"medium":"easy"}function A(e){const t=p(e),n=d(e);let s=.5;return t.length>100&&(s+=.2),n.length>5&&(s+=.1),h.some(r=>e.toLowerCase().includes(r))&&(s+=.1),(e.includes("function")||e.includes("class")||e.includes("method"))&&(s+=.1),Math.min(s,1)}function D(e){if(e.length===0)return"No content available for summarization.";const t=e.filter(n=>n.length>20).slice(0,3);return t.length===0?e[0]||"Content extracted but too short for meaningful summary.":t.join(" ")+"."}function _(e){return e.filter(t=>t.length>30&&t.length<150).slice(0,5).map(t=>t.trim())}function L(e,t,n){const s=[],r=d(e);return h.filter(i=>e.toLowerCase().includes(i)).slice(0,3).forEach((i,u)=>{s.push({id:`def_${u}`,question:`What is ${i}?`,answer:O(i,e),type:"definition",difficulty:n,tags:[...t,"definition"]})}),r.filter(i=>i.length>40&&i.length<120).slice(0,2).forEach((i,u)=>{const l=$(i);l&&s.push({id:`concept_${u}`,question:`Explain the concept of ${l}.`,answer:i,type:"concept",difficulty:n,tags:[...t,"concept"]})}),r.filter(i=>i.includes("is")||i.includes("are")||i.includes("was")||i.includes("were")).slice(0,2).forEach((i,u)=>{const l=I(i);l&&s.push({id:`fact_${u}`,question:`What is ${l}?`,answer:i,type:"fact",difficulty:n,tags:[...t,"fact"]})}),r.filter(i=>i.includes("step")||i.includes("process")||i.includes("method")||i.includes("procedure")).slice(0,1).forEach((i,u)=>{const l=j(i);l&&s.push({id:`process_${u}`,question:`What are the steps to ${l}?`,answer:i,type:"process",difficulty:n,tags:[...t,"process"]})}),s.slice(0,8)}function O(e,t){const s=d(t).find(o=>o.toLowerCase().includes(e.toLowerCase()));return s||{api:"An Application Programming Interface (API) is a set of rules and protocols that allows different software applications to communicate with each other.",function:"A function is a reusable block of code that performs a specific task and can be called from other parts of the program.",variable:"A variable is a container that stores data values and can be referenced and manipulated throughout a program.",class:"A class is a blueprint for creating objects that defines their properties and methods.",method:"A method is a function that belongs to a class or object and defines the behavior of that class or object.",object:"An object is an instance of a class that contains data and code to manipulate that data.",array:"An array is a data structure that stores a collection of elements in a specific order.",string:"A string is a sequence of characters used to represent text in programming.",database:"A database is an organized collection of structured information or data stored electronically.",framework:"A framework is a pre-built structure that provides a foundation for developing applications."}[e.toLowerCase()]||`${e} is a technical concept used in software development.`}function $(e){const t=[/the concept of (\w+)/i,/(\w+) is a/i,/(\w+) refers to/i,/(\w+) means/i];for(const n of t){const s=e.match(n);if(s)return s[1]}return null}function I(e){const t=[/(\w+) is (\w+)/i,/(\w+) are (\w+)/i,/(\w+) was (\w+)/i,/(\w+) were (\w+)/i];for(const n of t){const s=e.match(n);if(s)return s[1]}return null}function j(e){const t=[/the (\w+) process/i,/(\w+) procedure/i,/(\w+) method/i,/steps to (\w+)/i];for(const n of t){const s=e.match(n);if(s)return s[1]}return null}async function w(e){try{const t=`page_text_${Date.now()}`,n=m(e.text),s=g(e.text),r={text:e.text,url:e.url,title:e.title,timestamp:e.timestamp,processed:n,summarization:s};await chrome.storage.local.set({[t]:r});const o=await chrome.storage.local.get(null),a=Object.keys(o).filter(c=>c.startsWith("page_text_"));if(a.length>10){const c=a.sort().slice(0,a.length-10);await chrome.storage.local.remove(c)}console.log(`[${new Date().toISOString()}] Extracted summary:`,e.text.slice(0,200)),console.log(`[${new Date().toISOString()}] Processed stats:`,{wordCount:n.wordCount,readingTime:n.estimatedReadingTime,language:n.language,hasCode:n.hasCode,hasLinks:n.hasLinks}),console.log(`[${new Date().toISOString()}] Generated ${s.flashcards.length} flashcards and summary with ${Math.round(s.summary.confidence*100)}% confidence`)}catch(t){console.error("Starlet25: Error storing text:",t)}}chrome.runtime.onMessage.addListener((e,t,n)=>{e.type==="PAGE_TEXT"&&(console.log(`[${new Date().toISOString()}] Extracted summary:`,e.text.slice(0,200)),w(e),n({success:!0}))});chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.action==="GET_STORED_TEXTS")return chrome.storage.local.get(null).then(s=>{const r=Object.entries(s).filter(([o])=>o.startsWith("page_text_")).map(([o,a])=>({id:o,...a})).sort((o,a)=>a.timestamp-o.timestamp);n({texts:r})}),!0;if(e.action==="CLEAR_STORED_TEXTS")return chrome.storage.local.get(null).then(s=>{const r=Object.keys(s).filter(o=>o.startsWith("page_text_"));chrome.storage.local.remove(r).then(()=>{n({success:!0})})}),!0;if(e.action==="EXTRACT_CURRENT_PAGE")return chrome.tabs.query({active:!0,currentWindow:!0},s=>{s[0]?.id?chrome.tabs.sendMessage(s[0].id,{action:"EXTRACT_TEXT"},r=>{if(r&&r.text){const o=m(r.text),a=g(r.text),c={type:"PAGE_TEXT",text:r.text,url:r.url,title:r.title,timestamp:Date.now()};w(c),n({success:!0,text:r.text,processed:o,summarization:a})}else n({success:!1,error:"No text extracted"})}):n({success:!1,error:"No active tab found"})}),!0});chrome.runtime.onInstalled.addListener(()=>{console.log("Starlet25: Extension installed")});chrome.tabs.onUpdated.addListener((e,t,n)=>{t.status==="complete"&&n.url&&n.url.startsWith("http")&&setTimeout(()=>{chrome.tabs.sendMessage(e,{action:"EXTRACT_TEXT"}).catch(()=>{})},1e3)});
